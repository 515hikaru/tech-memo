---
title: "pnovel 0.4.1 をリリースしました"
date: 2020-05-26T00:00:00+09:00
draft: false
tags: ["Release Note", "pnovel"]
---

## 前置き

　以前別のブログではお知らせしましたが、日本語で小説を書くための簡易マークアップ言語のパーサーを作っています。

<iframe style="width:80%;height:150px;max-width:100%;margin:0 0 1.7rem;display:block;" title="小説を書くために小説を書くための軽量マークアップ言語とそのパーサーを実装してPixiv小説用にフォーマットするツールを作ったが、肝心の小説は書いていない - Diary over Finite Fields" src="https://hatenablog.com/embed?url=https://blog.515hikaru.net/entry/2020/05/18/005920" frameborder="0" scrolling="no"></iframe>

　簡易マークアップ言語と言っていますが、まだ仕様をしっかりとは決めていません。しかし、現時点で確定していることについて下記にまとめます。

* 改行は改行としては解釈しない
    * 改行をする場合は 1 行空白を空ける
    * 空白行を作る場合は `[newline]` トークンを利用する
* 段落の行頭に全角スペースを付す
    * ただし、下記の記号で始まる段落は例外（どちらも全角）
        * 「
        * （
* `# ${章のタイトル}` で章立てを表す 
* `%` で始まる行はコメント、パース時に無視します
    * 現在は文中に % があるとコメントとして解釈しません
* 「！」や「？」のあとには全角空白を空けるというルールがありますが、これを自動で守るように変換します
    * 現在は強制的に空白を空けてしまいますが、ここでは空白を空けたくないという場合は [raw-string 記法を作れないかと思案中](https://github.com/515hikaru/pnovel/issues/38)です

　改行の扱い、コメントの記法は LaTeX に合わせてみました。そのうち Example をたくさん書いたドキュメントを用意するつもりです。

### 動作方法

　さて、先日リリースの自動化を実現したので簡単にリリースができるようになりました。現時点では [NPM](https://www.npmjs.com/) のレジストリには公開していませんが、

```
npm config set @515hikaru:registry https://npm.pkg.github.com/515hikaru
```

という設定をすると `npm @515hikaru/pnovel` で動かすことができます。公式に [Docker Image](https://hub.docker.com/r/515hikaru/pnovel) も作っているのでそちらがよければどうぞ。

## 0.4.1 リリースの内容

　正直なところこのソフトウェアが広く使われるようになるとは全く思っていないのですが、なんとなく無駄に真面目にやりたくなったのでリリース内容を書きます。

* 「！」や「？」のあとには全角空白を空けるというルールを自動で守る機能を追加しました
    * 例えば「あ！田中さん！」のような文章を「あ！　田中さん！」に変換します
        * 閉じカッコの前の例外も対応しています
        * と書いたところで[バグを見つけました](https://github.com/515hikaru/pnovel/issues/40)
    * もともとの文章が正しく「あ！　田中さん！」とスペースが空いていたときも、問題なく表示されます

　まだまだバギーですが、鋭意開発していくつもりなのでよろしくお願いします。

## 今後の予定

　まずはパーサーを良くしていくのが前提なので、見つけたバグを潰していこうと思っています。その上で、2 つの側面からより便利にしていきたいなと考えています。

1. コマンドラインツールとして便利にする
2. ブラウザで使えるようにする

　わたしはプログラマなのでコマンドラインツールで動けばそれでいいのですが、やはりブラウザで動くというのは強みだと思うので（自分にとってもちょっと試すのに便利になるでしょうし）。ブラウザでこの形式でテキストを書くと、プレビューができて、パース結果をテキストファイルとしてダウンロードできる、みたいなものを考えています。ただ現時点では着手できていません。一旦はコマンドラインツールとして機能強化が優先になると思います。

　あとファイルの分割をサポートして、複数の原稿を `include` する、という機能はあってもいいんじゃないかと思っています。ひとつのファイルが何万行とかになったら嫌ですし。

今日は以上です。
